!function(window,factory){if(document.addEventListener){window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(callback,thisArg){thisArg=thisArg||window;for(var i=0;i<this.length;i++)callback.call(thisArg,this[i],i,this)});var pup=factory();null!=pup&&(window.pup=pup,window.onunload=function(){pup.sleep(),window.pup=null},document.addEventListener("DOMContentLoaded",(function(){pup.wakeup();var forms=document.querySelectorAll(pup.selector);forms.length&&forms.forEach((function(form){pup.init(form)}))})))}}(window,(function(){var ls=window.localStorage;if("object"!=typeof ls)return null;var lc=window.location,version="0.3.0",now=Date.now(),refer={url:document.referrer,enter:now,leave:now},current={url:completeURL(lc.href),enter:now,leave:now},notebook=null;function completeURL(url){return"/"===url.slice(-1)&&(url+="index.html"),url.toLowerCase()}function getNotebook(){notebook=ls.PUPsNoteBook;try{if(!notebook)throw"notebook is not available";if(!(notebook=JSON.parse(notebook))||"0.3.0"!==notebook.version)throw"notebook is not available or version does not match";var len=notebook.memory.length,last=notebook.memory[len-1];if(now-last.leave>5e3)throw">=5s";if(last.url===refer.url)notebook.memory.push(current);else{if(last.url!==current.url)throw"other";(current=last).leave=now}}catch(e){notebook={version:"0.3.0",memory:[refer,current]}}}function takenote(){current.leave=Date.now(),ls.PUPsNoteBook=JSON.stringify(notebook)}var _ticktack=null;function hardworking(){clearTimeout(_ticktack),takenote(),_ticktack=setTimeout(hardworking,3e3)}return{selector:"form.report_trace",home:function(selector){this.selector=selector},init:function(form){var pup=this,input=form.querySelector('input[name="track_report"]');input||((input=document.createElement("input")).setAttribute("name","track_report"),input.setAttribute("type","text"),input.setAttribute("style","display:none"),form.appendChild(input)),form.addEventListener("submit",(function(){input.value=pup.notes()}))},wakeup:function(){getNotebook(),hardworking()},sleep:function(){clearTimeout(_ticktack),takenote()},notes:function(){takenote();for(var notes={refer:notebook.memory[0].url,trace:[]},record=null,i=notebook.memory.length-1;i>0;i--)record=notebook.memory[i],notes.trace.push([record.url,Math.round((record.leave-record.enter)/1e3)]);return JSON.stringify(notes)}}}));
document.addEventListener('DOMContentLoaded',function(){var xform=document.querySelectorAll('input[name="track_report"]');var iform;for(iform=0;iform<xform.length;iform++){xform[iform].value="form_required";}});